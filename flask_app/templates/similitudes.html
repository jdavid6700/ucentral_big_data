{% extends "base.html" %}

{% block content %}

<h3 class="fw-bold mb-4">Similitudes entre Providencias</h3>

<form method="POST" class="card card-custom p-4 mb-4">

    <label class="form-label fw-semibold">Nombre de la Providencia</label>

    <input class="form-control search-box"
           name="nombre"
           placeholder="Ej: C-411-22">

    <button class="btn btn-dark mt-3 w-100">
        <i class="fa-solid fa-equals"></i> Buscar Similaridad
    </button>
</form>

{% if buscado %}
    {% if resultados %}
    <div class="card card-custom p-4 shadow-sm">

        <h5 class="fw-semibold mb-3">Resultados de Similaridad</h5>

        <table id="tablaSim" class="table table-striped align-middle">
            <thead>
                <tr>
                    <th>Providencia 1</th>
                    <th>Providencia 2</th>
                    <th>Similaridad</th>
                    <th>Acciones</th>
                </tr>
            </thead>

            <tbody>
            {% for r in resultados %}
                <tr>
                    <td class="fw-bold">{{ r["providencia_1"] }}</td>
                    <td class="fw-bold">{{ r["providencia_2"] }}</td>

                    <td data-order="{{ r['similaridad'] }}">
                        <span class="badge bg-primary fs-6">
                            {{ "%.4f"|format(r["similaridad"]) }}
                        </span>
                    </td>

                    <td>
                        <a class="btn btn-outline-primary btn-sm"
                        href="/detalle/{{ r['providencia_1'] }}/0">
                            Ver P1
                        </a>

                        <a class="btn btn-outline-secondary btn-sm"
                        href="/detalle/{{ r['providencia_2'] }}/0">
                            Ver P2
                        </a>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>

    </div>
    {% else %}
        {% include 'no_results.html' %}
    {% endif %}
{% endif %}

{% endblock %}


{% block scripts %}
<!-- ESTE SCRIPT SE EJECUTA DESPUÃ‰S DE CARGAR JQUERY + DATATABLES -->
<script>
$(document).ready(function() {
    console.log("ðŸ”„ Inicializando DataTables...");

    $('#tablaSim').DataTable({
        "order": [[2, "desc"]],  // Orden por columna de Similaridad
        "pageLength": 10,
        "lengthChange": false,
        "language": {
            "search": "Buscar:",
            "zeroRecords": "No se encontraron resultados",
            "info": "Mostrando _START_ a _END_ de _TOTAL_ registros",
            "paginate": {
                "previous": "Anterior",
                "next": "Siguiente"
            }
        }
    });
});
</script>
{% endblock %}
